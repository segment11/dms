<div ng-controller="MainCtrl">

    <div class="container-fluid">

        <div class="row-fluid">

            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-info"></i></span>
                    <h5>Redis Service - {{one.name}}</h5>
                    <div class="actions">
                        <button class="btn" ng-click="refresh()">Refresh</button>
                        <button class="btn" ng-click="goServiceJobs()">Jobs</button>
                        <button class="btn btn-gray" ng-click="goAppDetail(ext.appId, ext.appName, ext.appDes)"
                                ng-show="one.mode == 'standalone' || one.mode == 'sentinel'">Go To Target DMS App
                        </button>
                        <button class="btn" ng-click="back()">Back</button>
                    </div>
                </div>
                <div class="widget-content">
                    <span class="bg-info">Last Refreshed: {{tmp.refreshTime | date:'yyyy/MM/dd HH:mm:ss'}}</span>
                    <div class="row">
                        <div class="col-md-4">
                            <span>Description</span>
                            <span class="pull-right">{{one.des}}</span>
                        </div>
                        <div class="col-md-4">
                            <span>Mode</span>
                            <span class="pull-right">{{one.mode}}</span>
                        </div>
                        <div class="col-md-4">
                            <span>Created Time</span>
                            <span class="pull-right">{{one.createdDate | date:'yyyy/MM/dd HH:mm:ss'}}</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <span>Engine Type</span>
                            <span class="pull-right">{{one.engineType}}</span>
                        </div>
                        <div class="col-md-4">
                            <span>Engine Version</span>
                            <span class="pull-right">{{one.engineVersion}}</span>
                        </div>
                        <div class="col-md-4">
                            <span>Config Template Name</span>
                            <span class="pull-right">{{ext.configTemplateName}}</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <span>Each Instance Max Memory</span>
                            <span class="pull-right">{{one.maxmemoryMb}} MB</span>
                            <button class="btn" ng-click="updateMaxmemory(one)">Update</button>
                        </div>
                        <div class="col-md-4">
                            <span>Shards</span>
                            <span class="pull-right">{{one.shards}}</span>
                            <button class="btn" ng-click="doScale(one)" ng-show="'cluster' == one.mode">Scale</button>
                        </div>
                        <div class="col-md-4">
                            <span>Replicas</span>
                            <span class="pull-right">{{one.replicas}}</span>
                            <button class="btn" ng-click="doUpdateReplicas(one)">Change Replicas</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <span>First Instance Port</span>
                            <span class="pull-right">{{one.port}}</span>
                        </div>
                        <div class="col-md-4">
                            <span>Node Tags</span>
                            <span class="pull-right">{{one.nodeTags}}</span>
                        </div>
                        <div class="col-md-4">
                            <span>Node Tags By Replica Index</span>
                            <span class="pull-right">{{one.nodeTagsByReplicaIndex}}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-info"></i></span>
                    <h5>Connect</h5>
                </div>
                <div class="widget-content">
                    <div class="row">
                        <div class="col-md-4">
                            <span>Password</span>
                            <span class="pull-right">{{one.pass ? '***' : 'Anonymous'}}</span>
                            <button class="btn" ng-click="viewPass(one)" ng-show="one.pass">View Password</button>
                        </div>
                        <div class="col-md-8">
                            <span>Connection String</span>
                            <span class="pull-right">{{ext.connectionString}}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-info"></i></span>
                    <h5>Status</h5>
                </div>
                <div class="widget-content">
                    <div class="row">
                        <div class="col-md-2">
                            <span class="bg-info">{{one.status}}</span>
                        </div>
                        <div class="col-md-10" ng-show="!checkResult.isOk">
                            <span>Check Result Message</span>
                            <span class="bg-danger pull-right">{{checkResult.message}}</span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-list"></i></span>
                    <h5>Instances</h5>
                </div>
                <div class="widget-content">
                    <div class="row">
                        <h5>Nodes</h5>
                        <table class="table table-bordered table-striped m_top6">
                            <tr>
                                <th width="10%">Shard Index</th>
                                <th width="10%">Replica Index</th>
                                <th width="10%">Is Primary</th>
                                <th width="20%">Node Ip / Port</th>
                                <th width="10%">Status</th>
                                <th width="20%">{{one.mode == 'cluster' ? 'Slot Range' : 'Other'}}</th>
                                <th></th>
                            </tr>
                            <tr ng-repeat="node in nodes">
                                <td>
                                    {{node.shardIndex}}
                                </td>
                                <td>{{node.replicaIndex}}</td>
                                <td>
                                    <span ng-class="{'bg-info': !node.isPrimary, 'bg-success': node.isPrimary}">{{node.isPrimary}}</span>
                                </td>
                                <td>{{node.ip}}:{{node.port}}</td>
                                <td>
                                    <span ng-class="{'bg-danger': !node.running, 'bg-success': node.running}">{{node.running ? 'running' : 'unhealthy'}}</span>
                                </td>
                                <td>
                                    <ul ng-show="one.mode == 'cluster' && node.isPrimary">
                                        <li ng-repeat="slotRange in node.slotRangeList">
                                            {{slotRange.begin}}-{{slotRange.end}}
                                        </li>
                                    </ul>
                                </td>
                                <td>
                                    <div class="btn-line">
                                        <button class="btn btn-gray"
                                                ng-click="goAppDetail(node.appId, node.appName)"
                                                ng-show="one.mode == 'cluster' && node.isPrimary">
                                            Go To Target DMS App
                                        </button>
                                        <button class="btn bg-danger"
                                                ng-click="doFailover(one.id, node.shardIndex, node.replicaIndex)"
                                                ng-show="!node.isPrimary && node.running">
                                            Do Failover
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                </div>
            </div>

        </div><!-- /.row-fluid -->

    </div>

</div>
